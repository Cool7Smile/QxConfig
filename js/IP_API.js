
// è‡ªç”¨qxæ ‡é¢˜æ˜¾ç¤ºè„šæœ¬ï¼Œä»KOP-XIAOä¿®æ”¹

// usage:  geo_location_checker=http://ip-api.com/json/?fields=21753855&lang=zh-CN, https://raw.githubusercontent.com/Cool7Smile/QxConfig/main/js/IP_API.js

// original Shawn's:  https://raw.githubusercontent.com/KOP-XIAO/QuantumultX/master/Scripts/IP_API.js


if ($response.statusCode !== 200) {
  $done(null);
}

const citytest = /[a-zA-Z]+[a-zA-Z]+/;

function placeAdder(para) {
  if (para) {
    if (citytest.test(para)) {
      return '';
    }
    return ` ${para}`;
  }
  return '';
}

function geticon(para, paraa) {
  if (para === true) {
    return `${paraa} `;
  }
  return '';
}

const flags = new Map([ ['AC', 'ğŸ‡¦ğŸ‡¨'], ['AD', 'ğŸ‡¦ğŸ‡©'], ['AE', 'ğŸ‡¦ğŸ‡ª'], ['AF', 'ğŸ‡¦ğŸ‡«'], ['AG', 'ğŸ‡¦ğŸ‡¬'], ['AI', 'ğŸ‡¦ğŸ‡®'], ['AL', 'ğŸ‡¦ğŸ‡±'], ['AM', 'ğŸ‡¦ğŸ‡²'], ['AO', 'ğŸ‡¦ğŸ‡´'], ['AQ', 'ğŸ‡¦ğŸ‡¶'], ['AR', 'ğŸ‡¦ğŸ‡·'], ['AS', 'ğŸ‡¦ğŸ‡¸'], ['AT', 'ğŸ‡¦ğŸ‡¹'], ['AU', 'ğŸ‡¦ğŸ‡º'], ['AW', 'ğŸ‡¦ğŸ‡¼'], ['AX', 'ğŸ‡¦ğŸ‡½'], ['AZ', 'ğŸ‡¦ğŸ‡¿'], ['BA', 'ğŸ‡§ğŸ‡¦'], ['BB', 'ğŸ‡§ğŸ‡§'], ['BD', 'ğŸ‡§ğŸ‡©'], ['BE', 'ğŸ‡§ğŸ‡ª'], ['BF', 'ğŸ‡§ğŸ‡«'], ['BG', 'ğŸ‡§ğŸ‡¬'], ['BH', 'ğŸ‡§ğŸ‡­'], ['BI', 'ğŸ‡§ğŸ‡®'], ['BJ', 'ğŸ‡§ğŸ‡¯'], ['BM', 'ğŸ‡§ğŸ‡²'], ['BN', 'ğŸ‡§ğŸ‡³'], ['BO', 'ğŸ‡§ğŸ‡´'], ['BR', 'ğŸ‡§ğŸ‡·'], ['BS', 'ğŸ‡§ğŸ‡¸'], ['BT', 'ğŸ‡§ğŸ‡¹'], ['BV', 'ğŸ‡§ğŸ‡»'], ['BW', 'ğŸ‡§ğŸ‡¼'], ['BY', 'ğŸ‡§ğŸ‡¾'], ['BZ', 'ğŸ‡§ğŸ‡¿'], ['CA', 'ğŸ‡¨ğŸ‡¦'], ['CD', 'ğŸ‡¨ğŸ‡©'], ['CF', 'ğŸ‡¨ğŸ‡«'], ['CG', 'ğŸ‡¨ğŸ‡¬'], ['CH', 'ğŸ‡¨ğŸ‡­'], ['CI', 'ğŸ‡¨ğŸ‡®'], ['CK', 'ğŸ‡¨ğŸ‡°'], ['CL', 'ğŸ‡¨ğŸ‡±'], ['CM', 'ğŸ‡¨ğŸ‡²'], ['CN', 'ğŸ‡¨ğŸ‡³'], ['CO', 'ğŸ‡¨ğŸ‡´'], ['CP', 'ğŸ‡¨ğŸ‡µ'], ['CR', 'ğŸ‡¨ğŸ‡·'], ['CU', 'ğŸ‡¨ğŸ‡º'], ['CV', 'ğŸ‡¨ğŸ‡»'], ['CW', 'ğŸ‡¨ğŸ‡¼'], ['CX', 'ğŸ‡¨ğŸ‡½'], ['CY', 'ğŸ‡¨ğŸ‡¾'], ['CZ', 'ğŸ‡¨ğŸ‡¿'], ['DE', 'ğŸ‡©ğŸ‡ª'], ['DG', 'ğŸ‡©ğŸ‡¬'], ['DJ', 'ğŸ‡©ğŸ‡¯'], ['DK', 'ğŸ‡©ğŸ‡°'], ['DM', 'ğŸ‡©ğŸ‡²'], ['DO', 'ğŸ‡©ğŸ‡´'], ['DZ', 'ğŸ‡©ğŸ‡¿'], ['EA', 'ğŸ‡ªğŸ‡¦'], ['EC', 'ğŸ‡ªğŸ‡¨'], ['EE', 'ğŸ‡ªğŸ‡ª'], ['EG', 'ğŸ‡ªğŸ‡¬'], ['EH', 'ğŸ‡ªğŸ‡­'], ['ER', 'ğŸ‡ªğŸ‡·'], ['ES', 'ğŸ‡ªğŸ‡¸'], ['ET', 'ğŸ‡ªğŸ‡¹'], ['EU', 'ğŸ‡ªğŸ‡º'], ['FI', 'ğŸ‡«ğŸ‡®'], ['FJ', 'ğŸ‡«ğŸ‡¯'], ['FK', 'ğŸ‡«ğŸ‡°'], ['FM', 'ğŸ‡«ğŸ‡²'], ['FO', 'ğŸ‡«ğŸ‡´'], ['FR', 'ğŸ‡«ğŸ‡·'], ['GA', 'ğŸ‡¬ğŸ‡¦'], ['GB', 'ğŸ‡¬ğŸ‡§'], ['GD', 'ğŸ‡¬ğŸ‡©'], ['GE', 'ğŸ‡¬ğŸ‡ª'], ['GF', 'ğŸ‡¬ğŸ‡«'], ['GH', 'ğŸ‡¬ğŸ‡­'], ['GI', 'ğŸ‡¬ğŸ‡®'], ['GL', 'ğŸ‡¬ğŸ‡±'], ['GM', 'ğŸ‡¬ğŸ‡²'], ['GN', 'ğŸ‡¬ğŸ‡³'], ['GP', 'ğŸ‡¬ğŸ‡µ'], ['GR', 'ğŸ‡¬ğŸ‡·'], ['GT', 'ğŸ‡¬ğŸ‡¹'], ['GU', 'ğŸ‡¬ğŸ‡º'], ['GW', 'ğŸ‡¬ğŸ‡¼'], ['GY', 'ğŸ‡¬ğŸ‡¾'], ['HK', 'ğŸ‡­ğŸ‡°'], ['HN', 'ğŸ‡­ğŸ‡³'], ['HR', 'ğŸ‡­ğŸ‡·'], ['HT', 'ğŸ‡­ğŸ‡¹'], ['HU', 'ğŸ‡­ğŸ‡º'], ['ID', 'ğŸ‡®ğŸ‡©'], ['IE', 'ğŸ‡®ğŸ‡ª'], ['IL', 'ğŸ‡®ğŸ‡±'], ['IM', 'ğŸ‡®ğŸ‡²'], ['IN', 'ğŸ‡®ğŸ‡³'], ['IR', 'ğŸ‡®ğŸ‡·'], ['IS', 'ğŸ‡®ğŸ‡¸'], ['IT', 'ğŸ‡®ğŸ‡¹'], ['JM', 'ğŸ‡¯ğŸ‡²'], ['JO', 'ğŸ‡¯ğŸ‡´'], ['JP', 'ğŸ‡¯ğŸ‡µ'], ['KE', 'ğŸ‡°ğŸ‡ª'], ['KG', 'ğŸ‡°ğŸ‡¬'], ['KH', 'ğŸ‡°ğŸ‡­'], ['KI', 'ğŸ‡°ğŸ‡®'], ['KM', 'ğŸ‡°ğŸ‡²'], ['KN', 'ğŸ‡°ğŸ‡³'], ['KP', 'ğŸ‡°ğŸ‡µ'], ['KR', 'ğŸ‡°ğŸ‡·'], ['KW', 'ğŸ‡°ğŸ‡¼'], ['KY', 'ğŸ‡°ğŸ‡¾'], ['KZ', 'ğŸ‡°ğŸ‡¿'], ['LA', 'ğŸ‡±ğŸ‡¦'], ['LB', 'ğŸ‡±ğŸ‡§'], ['LC', 'ğŸ‡±ğŸ‡¨'], ['LI', 'ğŸ‡±ğŸ‡®'], ['LK', 'ğŸ‡±ğŸ‡°'], ['LR', 'ğŸ‡±ğŸ‡·'], ['LS', 'ğŸ‡±ğŸ‡¸'], ['LT', 'ğŸ‡±ğŸ‡¹'], ['LU', 'ğŸ‡±ğŸ‡º'], ['LV', 'ğŸ‡±ğŸ‡»'], ['LY', 'ğŸ‡±ğŸ‡¾'], ['MA', 'ğŸ‡²ğŸ‡¦'], ['MC', 'ğŸ‡²ğŸ‡¨'], ['MD', 'ğŸ‡²ğŸ‡©'], ['MG', 'ğŸ‡²ğŸ‡¬'], ['MH', 'ğŸ‡²ğŸ‡­'], ['MK', 'ğŸ‡²ğŸ‡°'], ['ML', 'ğŸ‡²ğŸ‡±'], ['MM', 'ğŸ‡²ğŸ‡²'], ['MN', 'ğŸ‡²ğŸ‡³'], ['MO', 'ğŸ‡²ğŸ‡´'], ['MP', 'ğŸ‡²ğŸ‡µ'], ['MQ', 'ğŸ‡²ğŸ‡¶'], ['MR', 'ğŸ‡²ğŸ‡·'], ['MS', 'ğŸ‡²ğŸ‡¸'], ['MT', 'ğŸ‡²ğŸ‡¹'], ['MU', 'ğŸ‡²ğŸ‡º'], ['MV', 'ğŸ‡²ğŸ‡»'], ['MW', 'ğŸ‡²ğŸ‡¼'], ['MX', 'ğŸ‡²ğŸ‡½'], ['MY', 'ğŸ‡²ğŸ‡¾'], ['MZ', 'ğŸ‡²ğŸ‡¿'], ['NA', 'ğŸ‡³ğŸ‡¦'], ['NC', 'ğŸ‡³ğŸ‡¨'], ['NE', 'ğŸ‡³ğŸ‡ª'], ['NF', 'ğŸ‡³ğŸ‡«'], ['NG', 'ğŸ‡³ğŸ‡¬'], ['NI', 'ğŸ‡³ğŸ‡®'], ['NL', 'ğŸ‡³ğŸ‡±'], ['NO', 'ğŸ‡³ğŸ‡´'], ['NP', 'ğŸ‡³ğŸ‡µ'], ['NR', 'ğŸ‡³ğŸ‡·'], ['NZ', 'ğŸ‡³ğŸ‡¿'], ['OM', 'ğŸ‡´ğŸ‡²'], ['PA', 'ğŸ‡µğŸ‡¦'], ['PE', 'ğŸ‡µğŸ‡ª'], ['PF', 'ğŸ‡µğŸ‡«'], ['PG', 'ğŸ‡µğŸ‡¬'], ['PH', 'ğŸ‡µğŸ‡­'], ['PK', 'ğŸ‡µğŸ‡°'], ['PL', 'ğŸ‡µğŸ‡±'], ['PM', 'ğŸ‡µğŸ‡²'], ['PR', 'ğŸ‡µğŸ‡·'], ['PS', 'ğŸ‡µğŸ‡¸'], ['PT', 'ğŸ‡µğŸ‡¹'], ['PW', 'ğŸ‡µğŸ‡¼'], ['PY', 'ğŸ‡µğŸ‡¾'], ['QA', 'ğŸ‡¶ğŸ‡¦'], ['RE', 'ğŸ‡·ğŸ‡ª'], ['RO', 'ğŸ‡·ğŸ‡´'], ['RS', 'ğŸ‡·ğŸ‡¸'], ['RU', 'ğŸ‡·ğŸ‡º'], ['RW', 'ğŸ‡·ğŸ‡¼'], ['SA', 'ğŸ‡¸ğŸ‡¦'], ['SB', 'ğŸ‡¸ğŸ‡§'], ['SC', 'ğŸ‡¸ğŸ‡¨'], ['SD', 'ğŸ‡¸ğŸ‡©'], ['SE', 'ğŸ‡¸ğŸ‡ª'], ['SG', 'ğŸ‡¸ğŸ‡¬'], ['SI', 'ğŸ‡¸ğŸ‡®'], ['SK', 'ğŸ‡¸ğŸ‡°'], ['SL', 'ğŸ‡¸ğŸ‡±'], ['SM', 'ğŸ‡¸ğŸ‡²'], ['SN', 'ğŸ‡¸ğŸ‡³'], ['SR', 'ğŸ‡¸ğŸ‡·'], ['ST', 'ğŸ‡¸ğŸ‡¹'], ['SV', 'ğŸ‡¸ğŸ‡»'], ['SY', 'ğŸ‡¸ğŸ‡¾'], ['SZ', 'ğŸ‡¸ğŸ‡¿'], ['TC', 'ğŸ‡¹ğŸ‡¨'], ['TD', 'ğŸ‡¹ğŸ‡©'], ['TG', 'ğŸ‡¹ğŸ‡¬'], ['TH', 'ğŸ‡¹ğŸ‡­'], ['TJ', 'ğŸ‡¹ğŸ‡¯'], ['TL', 'ğŸ‡¹ğŸ‡±'], ['TM', 'ğŸ‡¹ğŸ‡²'], ['TN', 'ğŸ‡¹ğŸ‡³'], ['TO', 'ğŸ‡¹ğŸ‡´'], ['TR', 'ğŸ‡¹ğŸ‡·'], ['TT', 'ğŸ‡¹ğŸ‡¹'], ['TV', 'ğŸ‡¹ğŸ‡»'], ['TW', 'ğŸ‡¨ğŸ‡³'], ['TZ', 'ğŸ‡¹ğŸ‡¿'], ['UA', 'ğŸ‡ºğŸ‡¦'], ['UG', 'ğŸ‡ºğŸ‡¬'], ['UK', 'ğŸ‡¬ğŸ‡§'], ['UM', 'ğŸ‡ºğŸ‡²'], ['US', 'ğŸ‡ºğŸ‡¸'], ['UY', 'ğŸ‡ºğŸ‡¾'], ['UZ', 'ğŸ‡ºğŸ‡¿'], ['VA', 'ğŸ‡»ğŸ‡¦'], ['VC', 'ğŸ‡»ğŸ‡¨'], ['VE', 'ğŸ‡»ğŸ‡ª'], ['VG', 'ğŸ‡»ğŸ‡¬'], ['VI', 'ğŸ‡»ğŸ‡®'], ['VN', 'ğŸ‡»ğŸ‡³'], ['VU', 'ğŸ‡»ğŸ‡º'], ['WS', 'ğŸ‡¼ğŸ‡¸'], ['YE', 'ğŸ‡¾ğŸ‡ª'], ['YT', 'ğŸ‡¾ğŸ‡¹'], ['ZA', 'ğŸ‡¿ğŸ‡¦'], ['ZM', 'ğŸ‡¿ğŸ‡²'], ['ZW', 'ğŸ‡¿ğŸ‡¼'],]);

const { body } = $response;
const obj = JSON.parse(body);
const title = `${flags.get(obj.countryCode)} ${placeAdder(obj.country)} ${placeAdder(obj.city)}`;
const subtitle = `${geticon(obj.proxy, 'âš ï¸') + geticon(obj.hosting, 'ğŸ…—') + obj.isp}  â¤  ${obj.query}`;
const ip = obj.query;
const description = `${'\n' + 'ä½ç½® ['}${placeAdder(obj.country)}${placeAdder(obj.regionName)}${placeAdder(obj.city)}${placeAdder(obj.district)}]\n\n` + `IP [${obj.query}]\n\n` + `ISP [${obj.isp}]\n\n` + `ORG [${obj.org}]\n\n` + `ASN [${obj.as.replace(/ .*$/gi, '')}]\n\n` + `æ—¶åŒº [${obj.timezone}]\n\n` + `é‚®ç¼– [${obj.zip}]\n\n` + 'å®šä½ [' + ` çº¬åº¦ ${obj.lat},` + `ç»åº¦ ${obj.lon} ]`;

$done({ title, subtitle, ip, description,});
